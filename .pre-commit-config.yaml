repos:
  # κΈ°λ³Έ pre-commit ν›…λ“¤
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: end-of-file-fixer
        files: '\.py$'
      - id: trailing-whitespace
        files: '\.py$'
      - id: check-yaml
        files: '\.ya?ml$'
      - id: check-json
        files: '\.json$'
      - id: check-merge-conflict
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: debug-statements
        files: '\.py$'

  # Python μ½”λ“ ν¬λ§·ν… λ° λ¦°ν…
  - repo: https://github.com/psf/black
    rev: 24.10.0
    hooks:
      - id: black
        language_version: python3
        files: '\.py$'

  # λ΅μ»¬ μ»¤μ¤ν…€ ν›…λ“¤
  - repo: local
    hooks:
      # ν™κ²½λ³€μ νμΌ μƒμ„± (AWS Secrets Managerμ—μ„)
      - id: create-env-file
        name: Create Environment File from AWS Secrets Manager
        entry: bash -c "echo 'π” AWS Secrets Managerμ—μ„ ν™κ²½λ³€μ νμΌ μƒμ„± μ¤‘...' && python3 scripts/deploy-env.py"
        language: system
        files: 'scripts/deploy-env.py'
        pass_filenames: false
        always_run: false

      # SSH μ„¤μ • ν™•μΈ λ° μ„¤μ •
      - id: ssh-setup
        name: SSH Setup Check
        entry: bash -c "if [ ! -f ~/.ssh/id_rsa ]; then echo 'SSH ν‚¤κ°€ μ—†μµλ‹λ‹¤. SSH ν‚¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤...' && ssh-keygen -t rsa -b 4096 -C 'johnkdo2020@gmail.com' -f ~/.ssh/id_rsa -N '' && echo 'SSH ν‚¤κ°€ μƒμ„±λμ—μµλ‹λ‹¤. κ³µκ°ν‚¤λ¥Ό λ³µμ‚¬ν•μ„Έμ”:' && cat ~/.ssh/id_rsa.pub; else echo 'SSH ν‚¤κ°€ μ΄λ―Έ μ΅΄μ¬ν•©λ‹λ‹¤.'; fi"
        language: system
        pass_filenames: false
        always_run: true


      # Docker κ΄€λ ¨ νμΌ μ²΄ν¬
      - id: docker-check
        name: Docker Configuration Check
        entry: bash -c "echo 'Docker μ„¤μ •μ„ ν™•μΈν•©λ‹λ‹¤...' && if [ -f docker-compose.yml ]; then echo 'docker-compose.yml νμΌμ΄ μ΅΄μ¬ν•©λ‹λ‹¤.' && docker-compose config --quiet; fi"
        language: system
        files: 'docker-compose.yml|Dockerfile'
        pass_filenames: false

      # Poetry μμ΅΄μ„± μ²΄ν¬
      - id: poetry-check
        name: Poetry Dependencies Check
        entry: bash -c "echo 'Poetry μμ΅΄μ„±μ„ ν™•μΈν•©λ‹λ‹¤...' && poetry check"
        language: system
        files: 'pyproject.toml|poetry.lock'
        pass_filenames: false

      # AWS μκ²©μ¦λ… μ²΄ν¬
      - id: aws-credentials-check
        name: AWS Credentials Check
        entry: bash -c "echo 'AWS μκ²©μ¦λ…μ„ ν™•μΈν•©λ‹λ‹¤...' && if ! aws sts get-caller-identity >/dev/null 2>&1; then echo 'AWS μκ²©μ¦λ…μ΄ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤.' && echo 'AWS CLIλ¥Ό μ„¤μ •ν•κ±°λ‚ ν™κ²½λ³€μλ¥Ό ν™•μΈν•μ„Έμ”.' && exit 1; else echo 'AWS μκ²©μ¦λ…μ΄ μ¬λ°”λ¥΄κ² μ„¤μ •λμ–΄ μμµλ‹λ‹¤.'; fi"
        language: system
        files: 'server/app/src/core/secrets.py'
        pass_filenames: false

      # ν™κ²½λ³€μ νμΌ μ²΄ν¬
      - id: env-check
        name: Environment Files Check
        entry: bash -c "echo 'ν™κ²½λ³€μ νμΌμ„ ν™•μΈν•©λ‹λ‹¤...' && if [ -f nginx-certbot.env ]; then echo 'nginx-certbot.env νμΌμ΄ μ΅΄μ¬ν•©λ‹λ‹¤.'; fi && if [ -f .env ]; then echo '.env νμΌμ΄ μ΅΄μ¬ν•©λ‹λ‹¤.'; fi"
        language: system
        files: '\.env|nginx-certbot.env'
        pass_filenames: false

      # μ¤ν¬λ¦½νΈ μ‹¤ν–‰ κ¶ν• μ²΄ν¬
      - id: script-permissions
        name: Script Permissions Check
        entry: bash -c "echo 'μ¤ν¬λ¦½νΈ νμΌ κ¶ν•μ„ ν™•μΈν•©λ‹λ‹¤...' && find scripts/ -name '*.sh' -exec chmod +x {} \; && find scripts/ -name '*.py' -exec chmod +x {} \; && echo 'μ¤ν¬λ¦½νΈ μ‹¤ν–‰ κ¶ν•μ΄ μ„¤μ •λμ—μµλ‹λ‹¤.'"
        language: system
        files: 'scripts/.*\.(sh|py)$'
        pass_filenames: false
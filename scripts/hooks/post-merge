#!/bin/bash

# =============================================================================
# Git Pull 후 환경변수 파일 자동 생성 (서버용)
# =============================================================================

echo "🔐 Git pull 후 환경변수 파일 생성 중..."

# 환경변수 확인
if [ -z "$SECRET_NAME" ]; then
    echo "⚠️  SECRET_NAME 환경변수가 설정되지 않았습니다."
    echo "💡 다음 명령어로 환경변수를 설정하세요:"
    echo "   export SECRET_NAME=prod/intellius"
    exit 0
fi

if [ -z "$AWS_ACCESS_KEY_ID" ]; then
    echo "⚠️  AWS_ACCESS_KEY_ID 환경변수가 설정되지 않았습니다."
    exit 0
fi

if [ -z "$AWS_SECRET_ACCESS_KEY" ]; then
    echo "⚠️  AWS_SECRET_ACCESS_KEY 환경변수가 설정되지 않았습니다."
    exit 0
fi

# 환경변수 파일 생성 스크립트 실행
if [ -f "scripts/deploy-env.py" ]; then
    echo "🚀 AWS Secrets Manager에서 환경변수 파일 생성 중..."
    python3 scripts/deploy-env.py
    
    if [ $? -eq 0 ]; then
        echo "✅ 환경변수 파일 생성 완료!"
    else
        echo "❌ 환경변수 파일 생성 실패"
    fi
else
    echo "❌ scripts/deploy-env.py 파일을 찾을 수 없습니다."
fi
